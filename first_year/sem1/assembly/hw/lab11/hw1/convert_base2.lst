     1                                  %ifndef _CONVERT_BASE2_ASM_ 
     2                                  %define _CONVERT_BASE2_ASM_
     3                                  
     4                                  bits 32                         
     5                                  segment code use32 public code
     6                                  global convert_base2
     7                                  
     8                                  extern printf
     9                                  import printf msvcrt.dll
    10                                  
    11                                  segment data use32 class=data
    12 00000000 <res 00000021>              bits_arr resb 33
    13 00000021 <res 00000004>              copy resd 1
    14 00000025 257300                      format db "%s", 0
    15                                      
    16                                  segment code use32 class=code
    17                                      convert_base2:
    18 00000000 83C404                          add esp, 4
    19                                  
    20 00000003 B920000000                      mov ecx, 32
    21 00000008 BF[00000000]                    mov edi, bits_arr
    22 0000000D 8B542404                        mov edx, [esp + 4]
    23                                          
    24 00000011 FC                              cld
    25                                          convert_loop:
    26 00000012 89D0                                mov eax, edx
    27 00000014 83E001                              and eax, 1
    28 00000017 0430                                add al, '0'
    29 00000019 AA                                  stosb 
    30                                              
    31 0000001A D1EA                                shr edx, 1
    32 0000001C E2F4                            loop convert_loop
    33                                          
    34 0000001E B920000000                      mov ecx, 32
    35 00000023 BE[20000000]                    mov esi, bits_arr + 32
    36                                          
    37 00000028 FD                              std
    38                                          display_digits:
    39 00000029 890D[21000000]                      mov [copy], ecx
    40 0000002F AC                                  lodsb
    41 00000030 31DB                                xor ebx, ebx
    42 00000032 88C3                                mov bl, al
    43 00000034 53                                  push dword ebx
    44 00000035 68[25000000]                        push format
    45 0000003A FF15[00000000]                      call [printf]
    46 00000040 8B0D[21000000]                      mov ecx, [copy]
    47 00000046 83C408                              add esp, 8
    48 00000049 E2DE                            loop display_digits
    49                                          
    50 0000004B C20400                          ret 4
    51                                      
    52                                     
    53                                      
    54                                  %endif
