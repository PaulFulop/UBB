     1                                  bits 32 ; assembling for the 32 bits architecture
     2                                  
     3                                  ; declare the EntryPoint (a label defining the very first instruction of the program)
     4                                  global start        
     5                                  
     6                                  ; declare external functions needed by our program
     7                                  extern exit               ; tell nasm that exit exists even if we won't be defining it
     8                                  import exit msvcrt.dll    ; exit is a function that ends the calling process. It is defined in msvcrt.dll
     9                                                            ; msvcrt.dll contains exit, printf and all the other important C-runtime specific functions
    10                                  
    11                                  ; our data is declared here (the variables needed by our program)
    12                                  segment data use32 class=data
    13 00000000 010203010203010203          s1 db 1, 2, 3, 1, 2, 3, 1, 2, 3
    14                                      lens1 equ $ - s1
    15 00000009 010203                      s2 db 1, 2, 3
    16                                      lens2 equ $ - s2
    17 0000000C 00<rept>                    d times lens1 db 0
    18                                  
    19                                  ; our code starts here
    20                                  segment code use32 class=code
    21                                      start:
    22                                          ;Being given two strings of bytes, compute all positions where the second string appears as a substring in the first string.
    23                                          ;s1 = 1, 2, 3, 1, 2, 3, 1, 2, 3
    24                                          ;s2 = 1, 2, 3
    25                                          ;d = 0, 3, 6
    26                                          
    27 00000000 FC                              cld
    28 00000001 B909000000                      mov ecx, lens1
    29 00000006 E346                            jecxz End 
    30 00000008 31DB                            xor ebx, ebx
    31 0000000A 31C0                            xor eax, eax 
    32                                          
    33                                          find_substr:
    34 0000000C B903000000                          mov ecx, lens2
    35 00000011 BF[09000000]                        mov edi, s2 ;reset to the beginning of s2
    36 00000016 BE[00000000]                        mov esi, s1 ;reset to s1
    37 0000001B 01DE                                add esi, ebx ;move by 1 to verify the next substring 
    38                                              
    39 0000001D 29F7                                sub edi, esi
    40 0000001F 83FF03                              cmp edi, lens2
    41 00000022 7C2A                                jl End
    42                                              
    43 00000024 BF[09000000]                        mov edi, s2
    44                                              
    45 00000029 31D2                                xor edx, edx 
    46                                              verify_substr:
    47 0000002B 42                                      inc edx
    48 0000002C A6                                      cmpsb  
    49 0000002D 7515                                    jnz not_substring 
    50 0000002F E2FA                                loop verify_substr
    51                                              
    52 00000031 8998[0C000000]                      mov [d + eax], ebx 
    53 00000037 40                                  inc eax 
    54                                               
    55 00000038 43                                  inc ebx
    56 00000039 B909000000                          mov ecx, lens1
    57 0000003E 29D9                                sub ecx, ebx 
    58 00000040 E2CA                            loop find_substr
    59 00000042 EB0A                            jmp End
    60                                          
    61                                          not_substring:
    62 00000044 43                                  inc ebx 
    63 00000045 B909000000                          mov ecx, lens1
    64 0000004A 29D9                                sub ecx, ebx
    65 0000004C E2BE                                loop find_substr 
    66                                              
    67                                          End:
    68                                          
    69                                          ;mov al, [d]
    70                                          ;mov bl, [d + 1]
    71                                          ;mov cl, [d + 2]
    72                                          
    73                                          ; exit(0)
    74 0000004E 6A00                            push    dword 0      ; push the parameter for exit onto the stack
    75 00000050 FF15[00000000]                  call    [exit]       ; call exit to terminate the program
